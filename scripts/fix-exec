#!/usr/bin/env bash
# fix-exec â€” set executable bits on repo scripts and ~/bin (idempotent)

set -euo pipefail

# Resolve repo paths (works from MiMac or MiMac-dev)
BASE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$BASE_DIR")"

TARGETS=(
  "$PROJECT_ROOT/scripts"
  "$HOME/bin"
)

echo "[fix-exec] Ensuring executable bits on MiMac scripts..."
for dir in "${TARGETS[@]}"; do
  if [ -d "$dir" ]; then
    # Only chmod top-level files in each target dir
    find "$dir" -maxdepth 1 -type f -print0 2>/dev/null \
      | xargs -0 chmod +x 2>/dev/null || true
    echo "[fix-exec] Fixed executables in: $dir"
  else
    echo "[fix-exec] Skipping missing directory: $dir" >&2
  fi
done

echo "[fix-exec] Done."
